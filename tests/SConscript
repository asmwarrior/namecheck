Import ('env')

import subprocess as sp
proc = sp.Popen('gcc -dumpversion', shell=True, stdout=sp.PIPE)
version = proc.stdout.read()
version = version.strip()

if version == "4.6":
	env.Append(CXXFLAGS=['-I/usr/lib/gcc/x86_64-linux-gnu/4.6/plugin/include/'])
	deps = ['gcc_plugin_4.6']
else:
	env.Append(CXXFLAGS=['-I/usr/lib/gcc/x86_64-linux-gnu/4.7/plugin/include/'])	
	deps = ['gcc_plugin_4.7']

name = 'namecheck'	
inc = ['../namecheck']
src = ['APIMock.cpp', '../src/Visitor/BasePlugin.cpp', '../src/Visitor/RulesContainer.cpp', '../src/Visitor/NamingConventionPlugin.cpp']
src += ['../src/Visitor/UpperUnderscoreRule.cpp', '../src/Visitor/UpperCamelCaseRule.cpp', '../src/Visitor/LowerUnderscoreRule.cpp', '../src/Visitor/LowerCamelCaseRule.cpp', '../src/Visitor/DefaultRules.cpp', '../src/Visitor/Regex.cpp']
deps += ['gtest_main', 'gmock', 'gtest','boost_regex', 'mili']

env.CreateTest(name, inc, src, deps)